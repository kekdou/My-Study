### 系统状态与进程管理  

**进程** 是程序的一个运行实例，当执行一个命令或打开一个程序时，就会创建一个进程，linux作为一个多任务操作系统，可以同时运行成千上万个进程  

默认情况下，在终端执行的任何命令，都会作为前台进程运行，只能在一个命令执行完或手动终止后能输入下一个命令，但linux真正的多任务能力体现在后台进程上  

在命令末尾加上 `&`可以使命令在后台进行：`[命令] &`  

---

**top/htop：实时查看系统资源和进程**  

`top`  

top提供一个动态的、实时的系统性能概览，按 `q`键退出，按 `k`键，输入进程pid可以杀死该进程  

```shell
$ top
#顶部显示系统概览：系统时间、运行时间、登录用户、平均负载等
top - 10:30:00 up 2 days,  1:00,  1 user,  load average: 0.10, 0.15, 0.20
#接下来是进程列表，按CPU或内存排序
PID   USER   PR   NI   VIRT   RES   SHR  S   %CPU   %MEM   TIME+   COMMAND
1234  user   20   0    1.5g   120m  50m  S   5.0    3.0    0:05.12 node
```

`htop` 是 `top`的增强版，提供了更加美观，更易交互的界面，适于初学者  

*htop需要手动安装*  

---

**ps：查看当前进程**  

与top的实时性不同，ps用于查看系统某一时刻的进程状态，像一个“进程快照”   

`ps [选项]`  
- `ps aux`：最常用的组合，a显示所有用户的进程，u详细显示，x显示没有控制终端的进程
- `ps -ef`：e显示所有进程，f以树形结构显示进程关系

控制终端：  
当你打开一个终端，它会创建一个交互式会话，在这个会话中你输入的命令会作为前台进程运行，它们的输入来自键盘，输出显示在终端屏幕上，这个终端即称为进程的控制终端  

没有控制终端的进程（守护进程）：  
当一个进程不需要与用户交互，并且需要在后台持续运行以提供服务时，就会脱离控制终端，称为没有控制终端的进程，一般有以下特点： 
- 与用户无关
- 在后台运行
- 提供系统服务

守护进程由系统启动时自动运行，脱离任何终端，在后台工作直到系统关闭，保证了服务的持续可用性和稳定性  

在需要快速查找某个特定进程是否存在以及相关信息时，可搭配 `grep`使用  

```shell
#查找所有与nginx相关的进程
$ ps aux | grep nginx
```

在这个指令中，ps aux输出的是一大段文本，包含所有进程的详细信息，而 `|`的作用是将其哪一个命令的输出作为后一个命令的输入，因此即为在接受到的信息中查找有nginx的行  

---

**kill/killall：终止进程**  

kill 是一个系统调用，它向 Linux 内核请求，让内核向指定的进程发送一个信号

因此它的本意并非是“杀死”进程，而是 **“向进程发送信号”**  

linux中定义了许多信号，如：
- SIGINT(2)：在终端按 `Ctrl+C`，用于中断一个命令
- SIGTERM(15)：终止信号，kill的默认信号
- SIGKILL(9)：强制杀死信号，这是无法被忽略或捕获的信号

`kill [信号] [PID]`  
- `kill PID`：发送默认的SIGTERM信号，请求进程优雅退出
- `kill -9 PID`：发送SIGKILL信号，强制立即终止进程

优雅退出：  
当kill命令向进程发送SIGTERM信号时，它不是直接终止进程，而是提醒进程准备好退出  

此时进程可以：
- 执行清理任务：保存当前工作，释放内存，关闭文件，保存日志
- 退出：清理完成后自动终止
- 忽略信号：有些程序设计成忽略，为了防止被意外终止

```shell
#先用ps找到进程PID
$ ps aux | grep my_app
user  12345  0.5  2.0  123456  50000  pts/0 S+  10:00  0:05  python  my_app.py
#终止该进程
$ kill 12345
```

如果不确定进程的pid，但知道名称时，用killall会比较方便，不用先ps再kill  

`killall [信号] [进程名]`  
- `killall nginx`：终止所有名为nginx的进程
- `killall -9 nginx`：强制终止所有名为nginx的进程

```shell
#直接终止所有名为my_app的进程
$ killall my_app
```

---
